<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=windows-1250">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 1.0.2  (Win32)">
	<META NAME="CREATED" CONTENT="20020727;23410400">
	<META NAME="CHANGEDBY" CONTENT="Piotr Janczura">
	<META NAME="CHANGED" CONTENT="20030722;12031449">
	<STYLE>
	<!--
		@page { size: 21cm 29.7cm; margin: 2cm }
		P { margin-bottom: 0.21cm; font-family: "Arial", sans-serif }
		TD P { margin-bottom: 0.21cm; font-family: "Arial", sans-serif }
		TH P { margin-bottom: 0.21cm; font-family: "Arial", sans-serif; font-style: italic; font-weight: bold; text-align: center }
		A:link { color: #000080; text-decoration: underline }
		A:visited { color: #800000; text-decoration: underline }
		CODE { background: transparent }
		CODE.western { font-family: "Courier New", monospace; font-size: 10pt }
		CODE.cjk { font-family: "Cumberland", monospace }
		CODE.ctl { font-family: "Cumberland", monospace }
	-->
	</STYLE>
</HEAD>
<BODY LANG="pl-PL" LINK="#000080" VLINK="#800000">
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Mimo ci¹gle
i co raz czêœciej publikowanych projekt&oacute;w urz¹dzeñ
wyposa¿onych w port RS232 komputera PC nie znalaz³ siê w EP opis tego
portu i jego mo¿liwoœci oferowanych programiœcie. W artykule
przedstawiê klasy stworzone zgodnie z opracowanym interfejsem
komunikacji z urz¹dzeniami. S¹ to dwie klasy CRS232 (o tej samej
nazwie) jedna do pracy w dos a druga pod windows. Spos&oacute;b
komunikacji z portem jest identyczny w obu systemach dziêki
zastosowaniu interfejsu zgodnego z klas¹ CSterownik i kompilacji
warunkowej w³¹czaj¹cej klasê odpowiedni¹ dla danego systemu. Nie
opisujê funkcji i struktur potrzebnych do otwarcia konfiguracji i
komunikacji z RS w systemie windows. Podstawowy opis tych funkcji
znajduje siê na stronach EP gdzie mo¿na dowiedzieæ siê szczeg&oacute;³&oacute;w.
Jednak lektura nie bêdzie zbyt przyjemna i to nie z winy autora -
wsp&oacute;³praca z systemem windows nie nale¿y do przyg&oacute;d
wartych odbycia. Natomiast budowê portu RS232 pod dosem om&oacute;wi³em
jak potrafi³em najlepiej. Przedstawiam ten opis poniewa¿ bêdzie
przydatny np. w rozwi¹zaniach wymagaj¹cych specjalnych rozwi¹zañ gdy
czytelnik bêdzie chcia³ napisaæ w³asn¹ obs³ugê RS-a albo dla
programuj¹cych w assemblerze. Informacje zbiera³em z r&oacute;¿nych
Ÿr&oacute;de³ oraz dostêpnych przyk³ad&oacute;w. Postara³em siê
przetestowaæ pracê klasy RS232 pod windows i dos. Nie by³em jednak w
stanie sprawdziæ we wszystkich okolicznoœciach. Trudno je wszystkie
wymyœliæ a zw³aszcza zbudowaæ odpowiednie zestawy do test&oacute;w.
Programy maj¹ jednak tê przewagê ¿e mo¿na je poprawiaæ na ka¿dym
etapie projektowania i takie poprawki jak i rozbudowa s¹
przewidziane. Obecnie klasa CRS232 posiada tylko podstawowe
&ldquo;umiejêtnoœci&rdquo;. S¹ to konfiguracja szybkoœci transmisji,
kontroli parzystoœci, rozmiaru transmitowanego &ldquo;bajtu&rdquo;.
Zapis do portu ci¹gu danych, odczyt z bufora ci¹gu danych oraz
wymuszenie transmisji jednego znaku przed umieszczonymi uprzednio w
buforze. Klasa CRS232 nie powiadamia o odebraniu danych ani o
zakoñczeniu wysy³ania. Nale¿y samemu sprawdzaæ stan bufora
wejœciowego w programie g³&oacute;wnym wykonuj¹c metodê read() tak
jak to przewidziano dla wszystkich obiekt&oacute;w klas
dziedziczonych po CSterownik. Nie jest to najlepsze rozwi¹zanie ale
najprostsze i pozwalaj¹ce korzystaæ z CRS232 identycznie pod dos i
windows. Nale¿a³o by zaprogramowaæ CRS232 tak by obs³uga zdarzeñ
zwi¹zanych z portem odbywa³y siê poza programem g³&oacute;wnym w
osobnym w¹tku. W dosie takie rozwi¹zanie by³o by bardzo kulawe i nie
kompatybilne z windowsem. Nie oby³o by siê bez r&oacute;¿nic w
u¿ytkowaniu klasy i nie by³o by to zbyt proste dla niezaawansowanych
programist&oacute;w jako ¿e programowanie wielow¹tkowe niesie ze sob¹
wiele dodatkowych problem&oacute;w. Rozbudowanie CRS232 dla windows o
prace z dodatkowymi w¹tkami jest ci¹gle mo¿liwe.</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Zaczynamy od
pocz¹tku czyli od ty³u ... obudowy PC-ta gdzie umieszczone s¹ gniazda
port&oacute;w RS232. Wystêpuj¹ w dw&oacute;ch odmianach 9-pinowe i
25-pinowe oba mêskie. Nie ma dla nas wiêkszego znaczenia z kt&oacute;rego
portu bêdziemy korzystaæ bo to co jest nam potrzebne wystêpuje w obu
rodzajach port&oacute;w. Gniazdo 25pin wyposa¿one jest we wszystkie
sygna³y elektryczne obs³ugiwane W standardzie RS232 natomiast gniazdo
9pin posiada pewien podzbi&oacute;r w zupe³noœci wystarczaj¹cy do
nawi¹zania ³¹cznoœci. Wszystkie potrzebne informacje w tabeli:</FONT></P>
<P ALIGN=CENTER STYLE="margin-bottom: 0cm"><BR>
</P>
<TABLE WIDTH=522 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=4 CELLSPACING=0>
	<COL WIDTH=170>
	<COL WIDTH=334>
	<THEAD>
		<TR VALIGN=TOP>
			<TH WIDTH=170>
				<P ALIGN=CENTER><FONT SIZE=2>Numer wyprowadzenia</FONT></P>
			</TH>
			<TH WIDTH=334>
				<P ALIGN=CENTER><FONT SIZE=2>Oznaczenie wyprowadzenia</FONT></P>
			</TH>
		</TR>
	</THEAD>
</TABLE>
<TABLE WIDTH=522 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=4 CELLSPACING=0>
	<COL WIDTH=76>
	<COL WIDTH=85>
	<COL WIDTH=335>
	<THEAD>
		<TR VALIGN=TOP>
			<TH WIDTH=76>
				<P ALIGN=CENTER><FONT SIZE=2>25pin</FONT></P>
			</TH>
			<TH WIDTH=85>
				<P ALIGN=CENTER><FONT SIZE=2>9pin</FONT></P>
			</TH>
			<TH WIDTH=335>
				<P ALIGN=CENTER><BR>
				</P>
			</TH>
		</TR>
	</THEAD>
	<TBODY>
		<TR>
			<TD WIDTH=76 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD WIDTH=85>
				<P ALIGN=CENTER><BR>
				</P>
			</TD>
			<TD WIDTH=335>
				<P ALIGN=CENTER><FONT SIZE=2>PG </FONT>
				</P>
				<P ALIGN=CENTER><FONT SIZE=2>masa ochronna - ³¹cz¹ca obudowy</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=76 SDVAL="2" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>2</FONT></P>
			</TD>
			<TD WIDTH=85 SDVAL="3" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>3</FONT></P>
			</TD>
			<TD WIDTH=335>
				<P ALIGN=CENTER><FONT SIZE=2>TxD - wy, </FONT>
				</P>
				<P ALIGN=CENTER><FONT SIZE=2>dane nadawane</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=76 SDVAL="3" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>3</FONT></P>
			</TD>
			<TD WIDTH=85 SDVAL="2" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>2</FONT></P>
			</TD>
			<TD WIDTH=335>
				<P ALIGN=CENTER><FONT SIZE=2>RxD - we, </FONT>
				</P>
				<P ALIGN=CENTER><FONT SIZE=2>dane odbierane</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=76 SDVAL="4" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>4</FONT></P>
			</TD>
			<TD WIDTH=85 SDVAL="7" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>7</FONT></P>
			</TD>
			<TD WIDTH=335>
				<P ALIGN=CENTER><FONT SIZE=2>RTS - wy, </FONT>
				</P>
				<P ALIGN=CENTER><FONT SIZE=2>¿¹danie nadawania skierowane od DTE
				do DCE</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=76 SDVAL="5" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>5</FONT></P>
			</TD>
			<TD WIDTH=85 SDVAL="8" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>8</FONT></P>
			</TD>
			<TD WIDTH=335>
				<P ALIGN=CENTER><FONT SIZE=2>CTS - we, </FONT>
				</P>
				<P ALIGN=CENTER><FONT SIZE=2>gotowoœæ do nadania danych zg³oszona
				przez DCE do DTE</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=76 SDVAL="6" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>6</FONT></P>
			</TD>
			<TD WIDTH=85 SDVAL="6" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>6</FONT></P>
			</TD>
			<TD WIDTH=335>
				<P ALIGN=CENTER><FONT SIZE=2>DSR - we,</FONT></P>
				<P ALIGN=CENTER><FONT SIZE=2>gotowoœæ DCE - pracuje, jest sprawne
				i gotowe do wykonania ¿¹dañ z komputera steruj¹cego</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=76 SDVAL="7" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>7</FONT></P>
			</TD>
			<TD WIDTH=85 SDVAL="5" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>5</FONT></P>
			</TD>
			<TD WIDTH=335>
				<P ALIGN=CENTER><FONT SIZE=2>SG - masa sygna³u</FONT></P>
				<P ALIGN=CENTER><FONT SIZE=2>stanowi odniesienie dla wszystkich
				sygna³&oacute;w z³¹cza</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=76 SDVAL="8" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>8</FONT></P>
			</TD>
			<TD WIDTH=85 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD WIDTH=335>
				<P ALIGN=CENTER><FONT SIZE=2>DCD - we, </FONT>
				</P>
				<P ALIGN=CENTER><FONT SIZE=2>poziom sygna³u odbieranego przez
				modem zawiera siê w zakresie wartoœci prawid³owych</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=76 SDVAL="20" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>20</FONT></P>
			</TD>
			<TD WIDTH=85 SDVAL="4" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>4</FONT></P>
			</TD>
			<TD WIDTH=335>
				<P ALIGN=CENTER><FONT SIZE=2>DTR - wy,</FONT></P>
				<P ALIGN=CENTER><FONT SIZE=2>gotowoœæ DTE</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=76 SDVAL="22" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>22</FONT></P>
			</TD>
			<TD WIDTH=85 SDVAL="9" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>9</FONT></P>
			</TD>
			<TD WIDTH=335>
				<P ALIGN=CENTER><FONT SIZE=2>RI - we</FONT></P>
				<P ALIGN=CENTER><FONT SIZE=2>wskaŸnik wywo³ania - dzwonek -
				skierowany z DCE do DTE</FONT></P>
			</TD>
		</TR>
	</TBODY>
</TABLE>
<P ALIGN=CENTER STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Objaœnienia
do tabeli:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>DTE -
komputer</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>DCE -
urz¹dzenie pod³¹czone do komputera (czêsto te¿ komputer)</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Pr&oacute;cz
standardowego zastosowania poszczeg&oacute;lnych wyprowadzeñ ka¿de z
nich mo¿e byæ u¿yte jako niezale¿ne wejœcie lub wyjœcie jednobitowe.
Podkreœlenia wymaga fakt i¿ napiêcia sygna³&oacute;w z³¹cza RS232 nie
odpowiadaj¹ standardowi TTL. </FONT>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Dla linii
danych </FONT>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>1 logiczna
to napiêcia od -15V do -3V </FONT>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>0 logiczne
to napiêcia od 3V do 15V. </FONT>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Dla linii
steruj¹cych </FONT>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>1 logiczna
to napiêcia od 3V do 15V </FONT>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>0 logiczne
to napiêcia od -15V do -3V. </FONT>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Tu by³o
trochê rozbie¿noœci pomiêdzy literatur¹. Niekt&oacute;re Ÿr&oacute;d³a
podaj¹ napiêcia 25V i -25V w miejsce 15V i -15V.</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>W
najprostszym rozwi¹zaniu, stosowanym zw³aszcza w prostych
urz¹dzeniach, jak znane nam modu³y na procesorach serii '51 stosuje
siê kabel trzy¿y³owy z³o¿ony z sygna³&oacute;w SG, TxD, RxD. Aby
wykonaæ po³¹czenia nale¿y sprawdziæ kt&oacute;re piny w wybranym
³¹czu odpowiadaj¹ tym sygna³om.</FONT></P>
<P ALIGN=CENTER STYLE="margin-bottom: 0cm"><BR>
</P>
<TABLE WIDTH=392 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=4 CELLSPACING=0>
	<COL WIDTH=74>
	<COL WIDTH=50>
	<COL WIDTH=49>
	<COL WIDTH=69>
	<COL WIDTH=50>
	<COL WIDTH=51>
	<THEAD>
		<TR VALIGN=TOP>
			<TH WIDTH=74>
				<P ALIGN=CENTER><FONT SIZE=2>DTE</FONT></P>
			</TH>
			<TH WIDTH=50>
				<P ALIGN=CENTER><FONT SIZE=2>25pin</FONT></P>
			</TH>
			<TH WIDTH=49>
				<P ALIGN=CENTER><FONT SIZE=2>9pin</FONT></P>
			</TH>
			<TH WIDTH=69>
				<P ALIGN=CENTER><FONT SIZE=2>DCE</FONT></P>
			</TH>
			<TH WIDTH=50>
				<P ALIGN=CENTER><FONT SIZE=2>25pin</FONT></P>
			</TH>
			<TH WIDTH=51>
				<P ALIGN=CENTER><FONT SIZE=2>9pin</FONT></P>
			</TH>
		</TR>
	</THEAD>
	<TBODY>
		<TR>
			<TD WIDTH=74 VALIGN=TOP>
				<P ALIGN=CENTER><FONT SIZE=2>TxD</FONT></P>
			</TD>
			<TD WIDTH=50 VALIGN=BOTTOM SDVAL="2" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>2</FONT></P>
			</TD>
			<TD WIDTH=49 VALIGN=BOTTOM SDVAL="3" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>3</FONT></P>
			</TD>
			<TD WIDTH=69 VALIGN=TOP>
				<P ALIGN=CENTER><FONT SIZE=2>RxD</FONT></P>
			</TD>
			<TD WIDTH=50 VALIGN=BOTTOM SDVAL="3" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>3</FONT></P>
			</TD>
			<TD WIDTH=51 VALIGN=BOTTOM SDVAL="2" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>2</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=74 VALIGN=TOP>
				<P ALIGN=CENTER><FONT SIZE=2>RxD</FONT></P>
			</TD>
			<TD WIDTH=50 VALIGN=BOTTOM SDVAL="3" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>3</FONT></P>
			</TD>
			<TD WIDTH=49 VALIGN=BOTTOM SDVAL="2" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>2</FONT></P>
			</TD>
			<TD WIDTH=69 VALIGN=TOP>
				<P ALIGN=CENTER><FONT SIZE=2>TxD</FONT></P>
			</TD>
			<TD WIDTH=50 VALIGN=BOTTOM SDVAL="2" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>2</FONT></P>
			</TD>
			<TD WIDTH=51 VALIGN=BOTTOM SDVAL="3" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>3</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=74 VALIGN=TOP>
				<P ALIGN=CENTER><FONT SIZE=2>SG</FONT></P>
			</TD>
			<TD WIDTH=50 VALIGN=BOTTOM SDVAL="7" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>7</FONT></P>
			</TD>
			<TD WIDTH=49 VALIGN=BOTTOM SDVAL="5" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>5</FONT></P>
			</TD>
			<TD WIDTH=69 VALIGN=TOP>
				<P ALIGN=CENTER><FONT SIZE=2>SG</FONT></P>
			</TD>
			<TD WIDTH=50 VALIGN=BOTTOM SDVAL="7" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>7</FONT></P>
			</TD>
			<TD WIDTH=51 VALIGN=BOTTOM SDVAL="5" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>5</FONT></P>
			</TD>
		</TR>
	</TBODY>
</TABLE>
<P ALIGN=CENTER STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Wykonany w
ten spos&oacute;b kabel mo¿e r&oacute;wnie¿ pos³u¿yæ do po³¹czenia
dw&oacute;ch komputer&oacute;w PC. Zajmiemy siê jedynie komunikacj¹
wykonan¹ przy pomocy tego najprostszego po³¹czenia. Dalej zamiast
port RS232 numer jeden bêdê u¿ywa³ COM1 COM2 itd. To wszystko w
temacie sprzêt, po³¹czyliœmy dwa komputery i mo¿emy pisaæ program
kt&oacute;ry przeœle dane.</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Podstawowa
informacja na temat urz¹dzenia to adres jego portu. W przypadku
wiêkszoœci s¹ to urz¹dzenia bardziej skomplikowane i posiadaj¹
wiêksz¹ iloœæ port&oacute;w ale &ldquo;tabliczk¹ rejestracyjn¹&rdquo;
jest ten pierwszy. Drugim imieniem urz¹dzenia jest numer przerwania
na kt&oacute;re bêdzie zg³aszaæ ¿¹dania obs³ugi.</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>W dos
standardowo przypisane adresy, linie sprzêtowego przerwania oraz
wektory przerwañ programowych do portu przedstawiaj¹ siê nastêpuj¹co:</FONT></P>
<P ALIGN=CENTER STYLE="margin-bottom: 0cm"><BR>
</P>
<TABLE WIDTH=448 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=4 CELLSPACING=0>
	<COL WIDTH=101>
	<COL WIDTH=104>
	<COL WIDTH=103>
	<COL WIDTH=106>
	<THEAD>
		<TR>
			<TH WIDTH=101>
				<P ALIGN=CENTER><FONT SIZE=2>Nazwa portu</FONT></P>
			</TH>
			<TH WIDTH=104>
				<P ALIGN=CENTER><FONT SIZE=2>adres</FONT></P>
			</TH>
			<TH WIDTH=103>
				<P ALIGN=CENTER><FONT SIZE=2>przerwanie sprzêtowe</FONT></P>
			</TH>
			<TH WIDTH=106>
				<P ALIGN=CENTER><FONT SIZE=2>wektor przerwania</FONT></P>
			</TH>
		</TR>
	</THEAD>
	<TBODY>
		<TR>
			<TD WIDTH=101>
				<P ALIGN=CENTER><FONT SIZE=2>COM1</FONT></P>
			</TD>
			<TD WIDTH=104>
				<P ALIGN=CENTER><FONT SIZE=2>0x3f8</FONT></P>
			</TD>
			<TD WIDTH=103 SDVAL="4" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>4</FONT></P>
			</TD>
			<TD WIDTH=106>
				<P ALIGN=CENTER><FONT SIZE=2>0x0c</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=101>
				<P ALIGN=CENTER><FONT SIZE=2>COM2</FONT></P>
			</TD>
			<TD WIDTH=104>
				<P ALIGN=CENTER><FONT SIZE=2>0x2f8</FONT></P>
			</TD>
			<TD WIDTH=103 SDVAL="3" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>3</FONT></P>
			</TD>
			<TD WIDTH=106>
				<P ALIGN=CENTER><FONT SIZE=2>0x0b</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=101>
				<P ALIGN=CENTER><FONT SIZE=2>COM3</FONT></P>
			</TD>
			<TD WIDTH=104>
				<P ALIGN=CENTER><FONT SIZE=2>0x3e8</FONT></P>
			</TD>
			<TD WIDTH=103 SDVAL="4" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>4</FONT></P>
			</TD>
			<TD WIDTH=106>
				<P ALIGN=CENTER><FONT SIZE=2>0x0c</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=101>
				<P ALIGN=CENTER><FONT SIZE=2>COM4</FONT></P>
			</TD>
			<TD WIDTH=104>
				<P ALIGN=CENTER><FONT SIZE=2>0x2e8</FONT></P>
			</TD>
			<TD WIDTH=103 SDVAL="3" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>3</FONT></P>
			</TD>
			<TD WIDTH=106>
				<P ALIGN=CENTER><FONT SIZE=2>0x0b</FONT></P>
			</TD>
		</TR>
	</TBODY>
</TABLE>
<P ALIGN=CENTER STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Pierwsza
niejasnoœæ jak¹ mamy to przerwania. S¹ cztery porty i dwa przerwania.
Tego faktu nie mo¿emy przeoczyæ podczas tworzenia programu obs³ugi
portu, kt&oacute;ry korzysta z przerwañ. Na razie nadmieniê jedynie
i¿ nale¿y rozpoznaæ port, kt&oacute;ry zg³osi³ przerwanie przez test
odpowiedniego rejestru. Tym tematem zajmiemy siê w dalszej czêœci. W
przypadku standardowego przypisania adres&oacute;w, jak w tabeli
mo¿emy zdefiniowaæ sta³e liczbowe kt&oacute;re mo¿emy u¿yæ w
programie do adresowania portu:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>#define COM1
0x03f8</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>#define COM2
0x02f8</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>#define COM3
0x03e8</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>#define COM4
0x02e8</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Chocia¿ jest
rzecz¹ ma³o prawdopodobn¹, porty mog¹ mieæ inne adresy. W takim
przypadku powy¿szy zapis bêdzie b³êdny i w poszukiwaniu adres&oacute;w
musimy pogrzebaæ w pamiêci operacyjnej komputera. W trakcie startu,
BIOS zanim odszuka na dysku system operacyjny i przeka¿e mu
sterowanie dokonuje testu sprzêtu (p³yta, RAM, DMA). W&oacute;wczas
odnajduje porty szeregowe i w pamiêci operacyjnej pocz¹wszy od adresu
0x0040:0x0000 do adresu 0x0040:0x0007 wpisuje adresy znalezionych
port&oacute;w. Wartoœæ 0x00 oznacza brak portu. Dla dw&oacute;ch
port&oacute;w obszar ten mo¿e wygl¹daæ tak:</FONT></P>
<P ALIGN=CENTER STYLE="margin-bottom: 0cm"><BR>
</P>
<TABLE WIDTH=648 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=4 CELLSPACING=0>
	<COL WIDTH=143>
	<COL WIDTH=119>
	<COL WIDTH=113>
	<COL WIDTH=123>
	<COL WIDTH=108>
	<THEAD>
		<TR VALIGN=TOP>
			<TH WIDTH=143>
				<P ALIGN=CENTER><FONT SIZE=2>Nr portu</FONT></P>
			</TH>
			<TH WIDTH=119>
				<P ALIGN=CENTER><FONT SIZE=2>COM1</FONT></P>
			</TH>
			<TH WIDTH=113>
				<P ALIGN=CENTER><FONT SIZE=2>COM2</FONT></P>
			</TH>
			<TH WIDTH=123>
				<P ALIGN=CENTER><FONT SIZE=2>COM3</FONT></P>
			</TH>
			<TH WIDTH=108>
				<P ALIGN=CENTER><FONT SIZE=2>COM4</FONT></P>
			</TH>
		</TR>
	</THEAD>
	<TBODY>
		<TR VALIGN=TOP>
			<TD WIDTH=143>
				<P ALIGN=CENTER><FONT SIZE=2>Adres RAM</FONT></P>
			</TD>
			<TD WIDTH=119>
				<P ALIGN=CENTER><FONT SIZE=2>0x0040:0x0000</FONT></P>
			</TD>
			<TD WIDTH=113>
				<P ALIGN=CENTER><FONT SIZE=2>0x0040:0x0002</FONT></P>
			</TD>
			<TD WIDTH=123>
				<P ALIGN=CENTER><FONT SIZE=2>0x0040:0x004</FONT></P>
			</TD>
			<TD WIDTH=108>
				<P ALIGN=CENTER><FONT SIZE=2>0x0040:0x0006</FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=143>
				<P ALIGN=CENTER><FONT SIZE=2>Adres portu</FONT></P>
			</TD>
			<TD WIDTH=119>
				<P ALIGN=CENTER><FONT SIZE=2>0xf8,0x03</FONT></P>
			</TD>
			<TD WIDTH=113>
				<P ALIGN=CENTER><FONT SIZE=2>0xf8,0x02</FONT></P>
			</TD>
			<TD WIDTH=123>
				<P ALIGN=CENTER><FONT SIZE=2>0x00,0x00</FONT></P>
			</TD>
			<TD WIDTH=108>
				<P ALIGN=CENTER><FONT SIZE=2>0x00,0x00</FONT></P>
			</TD>
		</TR>
	</TBODY>
</TABLE>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Poniewa¿
interesuje nas adres czterech port&oacute;w umieszczonych w pamiêci w
zwartej strukturze mo¿na pos³u¿yæ siê tablic¹ zawieraj¹c¹ liczby
unsigned int. Podczas deklaracji nale¿y pamiêtaæ, ¿e nie jest to
zwyk³a tablica, dla kt&oacute;rej kompilator przydziela pamiêæ w
dowolnie wybranym miejscu przez system. Tablica musi obejmowaæ obszar
zawieraj¹cy interesuj¹ce nas dane.</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Oto
konstrukcja, kt&oacute;ra spe³ni powy¿szy warunek:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>const
unsigned int far com_adr=(unsigned int far)0x00400000L;</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>WskaŸnik
com_adr dotyczy tablicy, kt&oacute;rej pierwszy element, o indeksie
0, znajduje siê pod adresem 0x00400000L. Odwo³ywaæ siê do jej
element&oacute;w mo¿na jak do zwyk³ej tablicy :</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>int i,
element;</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>element=com_adr[i];</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Deklaruj¹c
tablicê nie podano jej rozmiaru wystarczy pamiêtaæ jakiego obszaru
dotyczy - mo¿emy znaleŸæ maksymalnie cztery porty. W definicji
wskaŸnika com_adr u¿yto s³owa kluczowego &quot;const&quot; w trosce
bezpieczeñstwo danych. Dziêki jego u¿yciu niemo¿liwe jest zmiana
obszaru do kt&oacute;rego mamy dostêp za poœrednictwem wskaŸnika
com_adr. Nigdy nie wiadomo czy piêæset linijek dalej i tydzieñ
p&oacute;Ÿniej osoba z tob¹ wsp&oacute;³pracuj¹ca nie zechce zrobiæ
czegoœ takiego com_adr[3]=0x222. Dziêki s³owu kluczowemu &quot;const&quot;
zobaczy b³¹d kompilacji. Je¿eli zdecydujemy siê na metodê ze
wskaŸnikiem do pamiêci, wczeœniej zdefiniowane sta³e COM... zostan¹
zast¹pione przez com... .</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>//tablica
com_adr jest ju¿ zdefiniowana</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>const
unsigned int com1=com_adr[0];</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>const
unsigned int com2=com_adr[1];</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>const
unsigned int com3=com_adr[2];</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>const
unsigned int com4=com_adr[3];</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Wyb&oacute;r
pomiêdzy t¹ metod¹ otrzymywania adres&oacute;w a sta³ymi COM...
bêdzie zale¿a³ od sytuacji. Poniewa¿ adresy port&oacute;w s¹ raczej
nie zmienne proponujê sta³e, przede wszystkim ze wzglêdu na szybkoœæ
okreœlania adresu w kodzie programu. Przedstawiony przyk³ad
pobierania adresu RS-a z pamiêci wykorzystamy podczas otwierania
portu w celu sprawdzenia czy urz¹dzenie istnieje. Je¿eli np.
com_adr[2]==0 to znaczy ¿e RS o tym adresie nie istnieje.</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Wspomnia³em
¿e urz¹dzenia dysponuj¹ wiêksz¹ iloœci¹ port&oacute;w (dalej zwanych
r&oacute;wnie¿ rejestrami ). Tak jest i w tym przypadku. Odpowiednie
sta³e opisuj¹ce ich adresy zdefiniowane s¹ w pliku rs232_dos.h. By
u³atwiæ korzystanie z tych port&oacute;w (rejestr&oacute;w) wszystkie
potrzebne informacje zebra³em w tabeli:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<TABLE WIDTH=823 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=4 CELLSPACING=0 STYLE="page-break-inside: auto">
	<COL WIDTH=74>
	<COL WIDTH=81>
	<COL WIDTH=45>
	<COL WIDTH=42>
	<COL WIDTH=40>
	<COL WIDTH=0>
	<COL WIDTH=491>
	<THEAD>
		<TR>
			<TH WIDTH=74>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Nazwa portu</FONT></P>
			</TH>
			<TH WIDTH=81>
				<P ALIGN=JUSTIFY><FONT SIZE=2>przesuniêcie</FONT></P>
			</TH>
			<TH COLSPAN=5 WIDTH=643>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Opis rejestr&oacute;w portu
				komunikacyjnego RS232</FONT></P>
			</TH>
		</TR>
	</THEAD>
	<TBODY>
		<TR>
			<TD WIDTH=74>
				<P ALIGN=CENTER><FONT SIZE=2><B>TBR</B> </FONT>
				</P>
				<P ALIGN=CENTER><FONT SIZE=2>bufor nadajnika</FONT></P>
			</TD>
			<TD WIDTH=81 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD ROWSPAN=2 COLSPAN=5 WIDTH=643>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Powy¿sze rejestry s³u¿¹ do kontaktu
				z rejestrami wejœcia wyjœcia portu RS232. Chocia¿ s¹ to dwa r&oacute;¿ne
				bufory THR nadawczy i RBR - bufor odbiorczy, dostêp do nich
				odbywa siê poprzez ten sam adres w przestrzeni adresowej port&oacute;w
				wejœcia wyjœcia procesora. Rozr&oacute;¿nienie w obrêbie portu
				RS232 odbywa siê przez aktywacjê r&oacute;¿nych sygna³&oacute;w
				podczas odczytu i zapisu WR i RD. Mo¿na u¿ywaæ sta³ej COM...
				zamiast rozgraniczaæ na THR i RBR.</FONT></P>
				<P ALIGN=JUSTIFY><BR>
				</P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=74>
				<P ALIGN=CENTER><FONT SIZE=2><B>RBR</B></FONT></P>
				<P ALIGN=CENTER><FONT SIZE=2>bufor odbiornika</FONT></P>
			</TD>
			<TD WIDTH=81 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=74>
				<P ALIGN=CENTER><FONT SIZE=2><B>DLL</B></FONT></P>
			</TD>
			<TD WIDTH=81 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD ROWSPAN=2 COLSPAN=5 WIDTH=643>
				<P ALIGN=JUSTIFY><FONT SIZE=2>DLL i DLH mniej i bardziej znacz¹cy
				bajt dzielnika prêdkoœci dostêpne gdy bit nr 7 rejestru LCR ma
				wartoœæ 1. Do tych rejestr&oacute;w wpisujemy mniej a nastêpnie
				bardziej znacz¹cy bit wartoœci, przez kt&oacute;r¹ podzielona
				liczba 115200 da prêdkoœæ przesy³ania danych. Rejestry te s³u¿¹
				r&oacute;wnie¿ do odczytu aktualnie ustawionej prêdkoœci. </FONT>
				</P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=74>
				<P ALIGN=CENTER><FONT SIZE=2><B>DLH</B></FONT></P>
			</TD>
			<TD WIDTH=81 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD ROWSPAN=7 WIDTH=74>
				<P ALIGN=CENTER><FONT SIZE=2><B>IER </B></FONT>
				</P>
				<P ALIGN=CENTER><FONT SIZE=2>rejestr aktywacji przerwañ</FONT></P>
			</TD>
			<TD ROWSPAN=7 WIDTH=81 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD COLSPAN=5 WIDTH=643>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Rejestr okreœlaj¹cy kiedy port ma
				generowaæ przerwanie. Pos³ugujemy siê tym rejestrem w celu
				umo¿liwienia reagowania na zaistnia³e zdarzenia bez koniecznoœci
				ci¹g³ego testowania stanu rejestru wejœciowego. Aby w³¹czyæ opcjê
				nale¿y ustawiæ w³aœciwy bit:</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94>
				<P ALIGN=CENTER STYLE="text-decoration: none"><FONT SIZE=2><I><B>bity</B></I></FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY STYLE="text-decoration: none"><FONT SIZE=2><I><B>Znaczenie
				bitu</B></I></FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94>
				<P ALIGN=CENTER><FONT SIZE=2>7 do 4</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>nieu¿ywane</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="3" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>3</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>za ka¿dym razem kiedy kt&oacute;rakolwiek
				z linii zewnêtrznych kontroli modemu zmieni sw&oacute;j stan. S¹
				to linie DSR, CTS, DCD, RI.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="2" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>2</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>w przypadku b³êdu parzystoœci
				powsta³ego podczas odbioru bitu lub wygenerowaniu sygna³u BREAK -
				oznacza przerwanie transmisji przez nadajnik.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>po ka¿dym wys³aniu znaku do
				rejestru przesuwnego, oznacza to zwolnienie rejestru wejœciowego
				i mo¿liwoœæ wpisania tam nowej wartoœci</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>po ka¿dym otrzymaniu znaku przez
				bufor odbieraj¹cy, nale¿y odczytaæ wartoœæ z rejestru wejœciowego
				by umo¿liwiæ rejestrowi przesuwnemu odebranie nowej wartoœci.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD ROWSPAN=8 WIDTH=74>
				<P ALIGN=CENTER><FONT SIZE=2><B>IIR </B></FONT>
				</P>
				<P ALIGN=CENTER><FONT SIZE=2>rejestr identyfikacji przerwañ</FONT></P>
			</TD>
			<TD ROWSPAN=8 WIDTH=81 SDVAL="2" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>2</FONT></P>
			</TD>
			<TD COLSPAN=5 WIDTH=643>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Rejestr identyfikacji przerwania:
				bity 1 i 2. Zawiera informacjê o rodzaju przerwania zg³oszonego
				przez port. Rejestr ten jest konsekwencj¹ rejestru IER. Tam
				ustawialiœmy, kt&oacute;re sytuacje maj¹ powodowaæ zg³oszenie
				przerwania, w tym rejestrze sprawdzamy jaka sytuacja wyst¹pi³a
				skoro port wygenerowaæ przerwanie.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94>
				<P ALIGN=CENTER><FONT SIZE=2><I><B>bity</B></I></FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2><I><B>Znaczenie bitu</B></I></FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>je¿eli wartoœæ bitu wynosi 0 to
				nast¹pi³o zg³oszenie przerwania. Odczytanie portu powoduje
				ustawienie tego bitu w stan 1 czyli &ldquo;nie zg³oszono
				przerwania&rdquo;. W przypadku wsp&oacute;³pracy dw&oacute;ch
				port&oacute;w RS232 na jednym przerwaniu nale¿y sprawdziæ czy w
				&quot;s¹siednim&quot; porcie ten sam bit nie sygnalizuje
				przerwania.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94>
				<P ALIGN=CENTER><FONT SIZE=2>2           1</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Grupa bit&oacute;w nr 2 i 1</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=45 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD WIDTH=42 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>wygenerowano przerwanie ze wzglêdu
				na zmianê linii DSR, CTS, DCD,RI.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=45 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD WIDTH=42 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>pusty rejestr THR wys³ano dan¹.
				Rejestr gotowy na przyjêcie nowej.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=45 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD WIDTH=42 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>pe³ny rejestr RBR odebrano znak.
				Nale¿y opr&oacute;¿niæ rejestr by przygotowaæ miejsce na now¹
				liczbê</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=45 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD WIDTH=42 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>przerwanie zg³oszono w wyniku
				stwierdzenia b³êdu.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD ROWSPAN=19 WIDTH=74>
				<P ALIGN=CENTER><FONT SIZE=2><B>LCR</B></FONT></P>
				<P ALIGN=CENTER><FONT SIZE=2>rejestr parametr&oacute;w transmisji</FONT></P>
			</TD>
			<TD ROWSPAN=19 WIDTH=81 SDVAL="3" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>3</FONT></P>
			</TD>
			<TD COLSPAN=5 WIDTH=643>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Rejestr konfiguracji portu
				szeregowego. Okreœla format jednostki informacyjnej wysy³anej
				przez port.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94>
				<P ALIGN=CENTER><FONT SIZE=2><I><B>bity</B></I></FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2><I><B>Znaczenie bitu</B></I></FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="7" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>7</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>jeœli ma wartoœæ 1 to do rejestr&oacute;w
				DLL i DLH mo¿na wpisaæ tak¹ liczbê, przez kt&oacute;r¹ podzielona
				liczba 115200 da prêdkoœæ transmisji</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="6" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>6</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>po jego ustawieniu w stan 1 wys³any
				zostaje sygna³ BREAK i transmisja zostaje przerwana.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD ROWSPAN=3 COLSPAN=2 WIDTH=94 SDVAL="5" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>5</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>wymuszenie stanu bitu kontrolnego</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=40 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD COLSPAN=2 WIDTH=492>
				<P ALIGN=JUSTIFY><FONT SIZE=2>brak wymuszenia - bit kontroli
				parzystoœci zostanie okreœlony przez UART</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=40 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD COLSPAN=2 WIDTH=492>
				<P ALIGN=JUSTIFY><FONT SIZE=2>je¿eli LCR.4==0 i LCR.3==1 to stan
				bitu zawsze 1.</FONT></P>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Je¿eli LCR.4==1 i LCR.3==1 to stan
				bitu zawsze 0.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94>
				<P ALIGN=CENTER><FONT SIZE=2>4           3</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Grupa bit&oacute;w nr 4 i 3
				definiuj¹ca typ kontroli parzystoœci</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=45>
				<P ALIGN=CENTER><FONT SIZE=2>X</FONT></P>
			</TD>
			<TD WIDTH=42 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Brak kontroli parzystoœci</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=45 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD WIDTH=42 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Nieparzystoœæ. Bit kontrolny
				zostanie ustawiony na jeden w przypadku parzystej iloœci jedynek
				na polu danych, je¿eli iloœæ jedynek jest nieparzysta bit
				ustawiony jest na zero.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=45 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD WIDTH=42 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Parzystoœæ. Bit kontrolny ustawiony
				jest na jeden je¿eli w polu danych wystêpuje nieparzysta liczba
				jedynek, je¿eli liczba jedynek jest parzysta wartoœæ bitu
				kontrolnego ustawiona jest na zero.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD ROWSPAN=3 COLSPAN=2 WIDTH=94 SDVAL="2" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>2</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>kontroluje liczbê bit&oacute;w
				stopu</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=42 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD WIDTH=491>
				<P ALIGN=JUSTIFY><FONT SIZE=2>1 bit stopu</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=42 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD WIDTH=491>
				<P ALIGN=JUSTIFY><FONT SIZE=2>2 bity stopu</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94>
				<P ALIGN=CENTER><FONT SIZE=2>1           0</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Grupa bit&oacute;w nr 1 i 0 :
				definiuj¹ liczbê bit&oacute;w danych w transmitowanym &ldquo;bajcie&rdquo;</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=45 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD WIDTH=42 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>5 bit&oacute;w danych </FONT>
				</P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=45 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD WIDTH=42 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>6 bit&oacute;w danych </FONT>
				</P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=45 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD WIDTH=42 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>7 bit&oacute;w danych </FONT>
				</P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=45 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD WIDTH=42 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>8 bit&oacute;w danych </FONT>
				</P>
			</TD>
		</TR>
		<TR>
			<TD ROWSPAN=8 WIDTH=74>
				<P ALIGN=CENTER><FONT SIZE=2><B>MCR</B></FONT></P>
				<P ALIGN=CENTER><FONT SIZE=2>rejestr sterowania modemem</FONT></P>
			</TD>
			<TD ROWSPAN=8 WIDTH=81>
				<P ALIGN=CENTER><FONT SIZE=2>4</FONT></P>
			</TD>
			<TD COLSPAN=5 WIDTH=643>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Rejestr kontroli modemu - pozwala
				ustawiæ stan sygna³&oacute;w DTR RTS i w³¹czyæ przerwania</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94>
				<P ALIGN=CENTER><FONT SIZE=2><I><B>bity</B></I></FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2><I><B>Znaczenie bitu</B></I></FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94>
				<P ALIGN=CENTER><FONT SIZE=2>7 do 5</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>nieu¿ywane</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="4" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>4</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>bit diagnostyczny powinien byæ
				ustawiony na 0. Brak dok³adniejszych informacji na ten temat.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="3" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>3</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>je¿eli ustawiony to UART mo¿e
				wysy³aæ przerwania</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="2" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>2</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>nie wykorzystywany</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>ustawienie stan linii RTS </FONT>
				</P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>ustawienie stan linii DTR </FONT>
				</P>
			</TD>
		</TR>
		<TR>
			<TD ROWSPAN=10 WIDTH=74>
				<P ALIGN=CENTER><FONT SIZE=2><B>LSR</B></FONT></P>
				<P ALIGN=CENTER><FONT SIZE=2>rejestr stanu transmisji</FONT></P>
			</TD>
			<TD ROWSPAN=10 WIDTH=81>
				<P ALIGN=CENTER><FONT SIZE=2>5</FONT></P>
			</TD>
			<TD COLSPAN=5 WIDTH=643>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Rejestr kontroli portu, informuje o
				zaistnieniu poni¿szych zdarzeñ. Odczytanie rejestru kasuje bity
				okreœlaj¹ce rodzaj b³êdu i bit sygnalizuj¹cy wykrycie sygna³u
				BREAK</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94>
				<P ALIGN=CENTER><FONT SIZE=2><I><B>bity</B></I></FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2><I><B>Znaczenie bitu</B></I></FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="7" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>7</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>nie u¿ywany</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="6" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>6</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>UART wys³a³ zawartoœæ bufora
				przesuwnego</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="5" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>5</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>zawartoœæ THR zosta³a przes³ana do
				buforu przesuwnego i mo¿na wys³aæ do THR now¹ dan¹</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="4" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>4</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>pojawi³ siê sygna³ BRAKE</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="3" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>3</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>odebrana iloœæ bit&oacute;w nie
				zgodna z uzgodnionym formatem</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="2" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>2</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>wyst¹pi³ b³¹d parzystoœci</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>wyst¹pi³o zamazanie poprzedniej
				wartoœci rejestru RBR przez now¹ dan¹</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>port odebra³ znak i jest on do
				odczytania w rejestrze RBR bit jest automatycznie zerowany
				podczas odczytu RBR</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD ROWSPAN=10 WIDTH=74>
				<P ALIGN=CENTER><FONT SIZE=2><B>MSR</B></FONT></P>
				<P ALIGN=CENTER><FONT SIZE=2>rejestr stanu modemu</FONT></P>
			</TD>
			<TD ROWSPAN=10 WIDTH=81>
				<P ALIGN=CENTER><FONT SIZE=2>6</FONT></P>
			</TD>
			<TD COLSPAN=5 WIDTH=643>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Rejestr kontroli stanu modemu.</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94>
				<P ALIGN=CENTER><FONT SIZE=2><I><B>bity</B></I></FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2><I><B>Znaczenie bitu</B></I></FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="7" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>7</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>stan linii DCD </FONT>
				</P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="6" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>6</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>stan linii RI-dzwonek </FONT>
				</P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="5" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>5</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>stan linii DSR </FONT>
				</P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="4" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>4</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>stan linii CTS </FONT>
				</P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="3" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>3</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>zmiana DCD od ostatniego odczytu
				tego rejestru</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="2" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>2</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>zmiana RI od ostatniego odczytu
				tego rejestru</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="1" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>1</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>zmiana DSR od ostatniego odczytu
				tego rejestru</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=2 WIDTH=94 SDVAL="0" SDNUM="1045;">
				<P ALIGN=CENTER><FONT SIZE=2>0</FONT></P>
			</TD>
			<TD COLSPAN=3 WIDTH=540>
				<P ALIGN=JUSTIFY><FONT SIZE=2>zmiana CTS od ostatniego odczytu
				tego rejestru</FONT></P>
			</TD>
		</TR>
		<TR>
			<TD COLSPAN=7 WIDTH=813>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Objaœnienie:</FONT></P>
				<P ALIGN=JUSTIFY><FONT SIZE=2>Kolumna &ldquo;przesuniêcie&rdquo;
				zawiera adresy rejestr&oacute;w wzglêdem adresu bazowego portu
				RS232 oznaczonego sta³ymi COM.... Odwo³anie do rejestru odbywa
				siê przez sumowanie adresu bazowego i przesuniêcia odpowiedniego
				temu rejestrowi np.: COM1+LSR.</FONT></P>
			</TD>
		</TR>
	</TBODY>
</TABLE>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Pisz¹c
bibliotekê staramy siê zrobiæ to tak by raz napisany kod m&oacute;g³
byæ u¿ywany wielokrotnie czyli kod biblioteki stworzony dla jednego
programu bêdzie pracowa³ w innym bez ¿adnych zmian, wykonuj¹c te same
czynnoœci w taki sam spos&oacute;b i co najwa¿niejsze nie bêdzie
powodowa³ awarii. Z drugiej strony programy w kt&oacute;rych u¿ywamy
danej biblioteki mog¹ dzia³aæ co najwy¿ej lepiej gdy w wyniku prac
rozwojowych nad bibliotek¹ zostan¹ zmienione cia³a funkcji.
Stworzy³em klasê CRS232 wyposa¿on¹ w metody zawieraj¹ce wszystkie
operacje na porcie. Na jej przyk³adzie om&oacute;wiê niezbêdne kroki
do nawi¹zania ³¹cznoœci z wykorzystaniem RS. Do pracy z przerwaniami
potrzebna jest pewna znajomoœæ uk³adu 8259 zarz¹dzaj¹cego 
przerwaniami. Przeka¿ê minimum informacji przy opisywaniu tego
zagadnienia w porcie RS232.</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Przygotowanie
portu do pracy</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<OL>
	<LI><P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>ZnajdŸ
	port - sprawdŸ czy jest do u¿ycia</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>O
	adresowaniu portu ju¿ napisa³em. Bêdziemy korzystaæ ze sta³ych a
	istnienie portu sprawdzimy w odpowiednim miejscu RAM. Klasa CRS232
	pozwala na kontrolowanie ponownego dostêpu do portu. W dos
	wykorzystuje do tego zmienne bool comX_otwarty, w win zajmuje siê
	tym j¹dro systemu.</FONT></P>
	<LI><P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Ustaw
	procedurê obs³ugi przerwania zg³aszanego przez ten port</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Dos pozwala
	podstawiæ w³asn¹ odpowiednio skonstruowan¹ funkcjê do wykonywania
	przerwania podpiêtego pod wskazany wektor. W przypadku portu RS232
	funkcja musi odpowiadaæ na r&oacute;¿ne zdarzenia zachodz¹ce podczas
	pracy. Budow¹ tej funkcji zajmê siê dalej w tym punkcie pokazujê jak
	j¹ podpi¹æ:</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Przed
	funkcj¹ main() definiujemy funkcjê obs³ugi przerwania:</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">void
	interrupt far irq1(...)</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">{</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">//
	...</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">//
	tu wszystkie operacie przewidziane na wypadek zg³oszenia przerwania
	przez port</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">//
	...</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">outportb(CTRL8259_ICR,EOI);</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">}</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Poniewa¿
	tego wymagaj¹ zasady musimy zapamiêtaæ adres poprzedniej procedury
	obs³uguj¹cej przechwytywane przerwanie. W przypadku RS232 tylko po
	to by po zamkniêciu portu oddaæ j¹ systemowi. W innych przerwaniach
	mo¿e byæ potrzeba wykonywania r&oacute;wnie¿ starej procedury.
	Zmienna przeznaczona do przechowywania wskaŸnika ma byæ
	zadeklarowana tak:</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">void
	interrupt far (*old_irq1)(...);</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Ci¹g
	poleceñ konieczny do podmiany procedur wygl¹da tak:</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">old_irq1=getvect(0x0c);
	// 0x0c dla port&oacute;w 1 i 3 a dla port&oacute;w 2 i 4 0x0b</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">setvect(0x0c,irq1);</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Od tej pory
	port przez kt&oacute;ry bêdziemy przesy³aæ dane wywo³a now¹
	procedurê : irq(...). </FONT>
	</P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Gdy pracuj¹
	dwa porty na jednym przerwaniu : COM1 z COM3 i COM2 z COM4 najlepiej
	bêdzie utworzyæ osobne procedury dla ka¿dego portu ale wywo³aæ je z
	procedury zbiorczej:</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">void
	interrupt far irq13(...)</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">{</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
	 if(!(inportb(COM1+IIR)&amp;0x01)){</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
	   irq1(); </CODE></FONT>
	</P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
	 }</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
	 if(!(inportb(COM3+IIR)&amp;0x01)){</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
	   irq3();</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
	 }</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
	 outportb(CTRL8259_ICR,EOI);</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>}</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Procedura
	sporz¹dzona dla drugiej pary port&oacute;w r&oacute;¿niæ siê bêdzie
	tylko indeksami procedur. Wywo³anie funkcji
	outportb(CTRL8259_ICR,EOI); Powinno nast¹piæ po obs³u¿eniu
	przerwania. Gdy pracuje procedura irq13 to wystarczy umieœciæ j¹
	tylko w tej procedurze. Skoro u¿yliœmy jednej procedury do obs³ugi
	dw&oacute;ch przerwañ to oczywiste jest ¿e trzeba rozpoznaæ kt&oacute;ry
	port zg³osi³ to przerwanie. Port kt&oacute;ry zg³osi³ przerwanie
	zeruje bit nr 0 w rejestrze IIR. O koniecznoœci wykonania procedury
	decyduje test if(!(inportb(adres_bazowy+IIR)&amp;0x01)). Je¿eli bit
	IIR.0 == 0 to ten port ¿¹da obs³ugi.</FONT></P>
</OL>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<OL>
	<LI><P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>ustaw
	prêdkoœæ transmisji</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Podstawowy
	parametr pracy portu RS232. Ustawiany przy pomocy rejestr&oacute;w
	DLL i DLH pokrywaj¹cych siê z rejestrami TBR/RBR i IER aby uaktywniæ
	rejestry DLL i DLH nale¿y ustawiæ bit LCR.7 po zakoñczeniu operacji
	zerujemy LCR.7.</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">outportb(port+LCR,inportb(port+LCR)|0x80);</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">outportb(port+DLL,(par
	&amp; 0x00FF));</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">outportb(port+DLH,
	((par &gt;&gt; 8) &amp; 0x00FF));</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">outportb(port+LCR,inportb(port+LCR)&amp;
	~0x80);</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"></P>
	<LI><P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>ustaw :
	bity danych, parzystoœæ, bity stopu</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Te trzy
	punkty ciê¿ko bêdzie zrealizowaæ osobno bo omawiane parametry
	ustawiane s¹ przez zmianê bit&oacute;w jednego rejestru. Zmieniaj¹c
	jeden parametr transmisji nie mo¿emy zniszczyæ pozosta³ych.
	Proponujê zastosowaæ maski bit&oacute;w odpowiadaj¹cych parametrowi
	i wykonywaæ operacje bitowe lub na jego obecnej wartoœci:</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PARZYSTOSC_BRAK_KONTROLI
	0x00</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PARZYSTOSC_KONTR_NIE_PRZYSTOSCI
	0x08</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PARZYSTOSC_KONTR_PRZYSTOSCI
	0x18</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PARZYSTOSC_M
	0xE7</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">BITY_DANYCH_5
	0x00</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">BITY_DANYCH_6
	0x01</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">BITY_DANYCH_7
	0x02</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">BITY_DANYCH_8
	0x03</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">BITY_DANYCH_M
	0xFC</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">BITY_STOPU_1
	0x00</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">BITY_STOPU_2
	0x04</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">BITY_STOPU_M
	0xFB</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Przy pomocy
	tych sta³ych ustawienie parametru np. kontroli parzystoœci mo¿na
	zrealizowaæ tak:</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">outportb(port+LCR,((inportb(port+LCR)&amp;BITY_STOPU_M)
	| BITY_STOPU_1);</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">outportb(port+LCR,((inportb(port+LCR)&amp;PARZYSTOSC_M)
	| PARZYSTOSC_BRAK_KONTROLI);</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">outportb(port+LCR,((inportb(port+LCR)&amp;BITY_DANYCH_M)
	| BITY_DANYCH_8);</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"></P>
	<LI><P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>ustaw
	bity odpowiadaj¹cy za zg³aszanie przerwania przez port</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Jako
	w³¹cznik zg³aszania przerwania wykorzystywany jest MCR.4. Ustawienie
	tego bitu w³¹cza zg³aszanie przerwañ przez port. Gdy MCR.3==0 port
	nie zg³asza przerwañ nie zale¿nie od innych ustawieñ. Po w³¹czeniu
	przerwania nale¿y wykonaæ (zaleca to literatura) poni¿sze operacje:</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>odczyt w
	celu skasowania znacznik&oacute;w b³êdu</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">inportb(port+LSR);</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>odczyt w
	celu skasowania bitu LSR.0</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">inportb(port+RBR);</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"></P>
	<LI><P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>ustaw
	bity odpowiadaj¹ce za informowanie interesuj¹cych nas zdarzeñ w
	porcie</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Aby wybraæ
	zdarzenia po kt&oacute;rych zg³aszane bêdzie przerwanie pos³ugujemy
	siê rejestrem IER. Zdarzenia na kt&oacute;re mo¿e reagowaæ
	przerwanie opisane s¹ w tabeli a do ich rozr&oacute;¿nienia w kodzie
	pos³u¿ymy siê sta³ymi zdefiniowanymi ni¿ej.</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">IER_ODEBRANE
	0x01</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">IER_NADAWANE
	0x02</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">IER_PARZYSTOSC_OR_BREAK
	0x04</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">IER_ZMIANA_NA_LINIACH
	0x08</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Aby w³¹czyæ
	zg³aszanie przerwania np. po odebraniu danej i wys³aniu danej
	wykonujemy to:</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">outportb(port+IER,IER_ODEBRANE
	| IER_NADANE);</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">inportb(port+LSR);
	// odczyt w celu skasowania znacznik&oacute;w b³êdu</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">inportb(port+RBR);
	// odczyt w celu skasowania bitu LSR.0</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>W
	przerwaniu rozpoznanie zdarzenia nastêpuje przez odczytanie rejestru
	IIR i sprawdzenie zdarzenia przez kontrolê odpowiednich bit&oacute;w.</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"></P>
	<LI><P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>zeruj
	bit steruj¹cy generowaniem przerwania dla tego portu w kontrolerze
	PIC.</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Ten uk³ad
	odpowiada za przesy³anie sygna³&oacute;w wszystkich o przerwaniach.
	Tam jest umieszczony g³&oacute;wny wy³¹cznik ka¿dego przerwania. Na
	samym koñcu konfigurowania gdy wszystkie parametry portu zosta³y
	wpisane do rejestr&oacute;w nale¿y w tym przerwaniu w³¹czyæ
	zg³aszanie przerwañ. Rejestr zawieraj¹cy bity kontrolne ma adres
	0x21. A bity to 4 dla COM1 i COM3 i bit 3 dla COM2 i COM4.</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PRZERWANIA_COM13
	0xEF</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PRZERWANIA_COM24
	0xE7</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">CTRL8259_IMR
	0x21</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>W³¹czanie
	przerwañ:</FONT></P>
</OL>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
     outport(CTRL8259_IMR,inport(CTRL8259_IMR)&amp;PRZERWANIA_COM13);</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
     outport(CTRL8259_IMR,inport(CTRL8259_IMR)&amp;PRZERWANIA_COM24);</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Zamkniêcie
portu </FONT>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<OL>
	<LI><P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Wy³¹cz
	generowanie przerwania przez PIC</FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">outport(CTRL8259_IMR,inport(CTRL8259_IMR)|
	~PRZERWANIA_COM13);</CODE></FONT></P>
	<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">outport(CTRL8259_IMR,inport(CTRL8259_IMR)|
	~PRZERWANIA_COM24);</CODE></FONT></P>
	<LI><P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Podmieñ
	procedury obs³ugi przerwañ. Podmiana procedur musi odbyæ siê z
	zapewnieniem mo¿liwoœci pracy przerwania obs³uguj¹cego ewentualnie
	pracuj¹ce drugie przerwanie.</FONT></P>
	<LI><P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Mo¿na
	przywr&oacute;ciæ stan wszystkich rejestr&oacute;w portu z przed
	przejêcia nad nim kontroli. Trzeba by w tym celu wszystkie je
	zapamiêtaæ w osobnych zmiennych. Moim zdaniem nie jest to konieczne.
	Zamykanie portu mo¿na zakoñczyæ na tych czynnoœciach.</FONT></P>
</OL>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Teraz parê
zdañ o czynnoœciach wykonywanych przez kod transmituj¹cy dane.</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>CRS232 jest
przyk³adem klasy daj¹cej swobodê u¿ycia znacznej czêœci kodu na
r&oacute;¿nych platformach. Jednoczeœnie przyk³adem jak odmiennoœci
systemu mog¹ pokomplikowaæ pisanie kodu. Spe³nienie podstawowego
warunku by pod win i dos klasa ta zachowywa³a siê identycznie
sprawi³o ¿e pod jednym jak i pod drugim systemem nie mo¿na by³o
zrobiæ wszystkiego na co dany system pozwala. Dos pozwala na lepszy
kontakt ze sprzêtem a win udostêpnia mechanizmy o wiele bardziej
zaawansowane - nowoczeœniejsze. Najwiêksz¹ &ldquo;strat¹&rdquo; jest
nie u¿ywanie przez CRS232 w¹tk&oacute;w w win. Wydaje mi siê ¿e
programowanie wielow¹tkowe niesie za sob¹ problemy z kt&oacute;rymi
wiêkszoœæ u¿ytkownik&oacute;w nie chce mieæ do czynienia i nie bêdzie
narzekaæ na brak tej mo¿liwoœci. Nic nie stoi na przeszkodzie by
rozbudowaæ CRS232 w kolejnych wersjach - rezygnuj¹c z kompatybilnoœci
z dosem, raczej nie wielka strata. Kodu wykonywanego przez CRS232 dla
win nie bêdê omawia³. Programowanie wsp&oacute;³pracy z tym systemem
jest doœæ niewdziêczne, poch³ania mn&oacute;stwo czasu, zw³aszcza na
&ldquo;parpanie&rdquo; w dokumentacji. Opis funkcji i metod
komunikowania siê portami szeregowymi znajduje siê na stronach EP
wobec czego nie bêdê o tym pisaæ. </FONT>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Programowanie
pod dosem om&oacute;wiê poruszaj¹c parê wa¿niejszych kwestii.
Najwiêkszym problemem jest poprawne obs³ugiwanie danych
przychodz¹cych do rejestru wejœciowego. Przerwanie za³atwia nam
mo¿liwoœæ pobrania ka¿dego nades³anego bajtu z rejestru wejœciowego i
wpisanie do bufora. Przetworzenie danych odbywa siê w programie
g³&oacute;wnym a ten pobiera dane gdy ... ma na to ochotê. Dane musz¹
wiêc czekaæ na ich pobranie w buforze. Zapisanie danej do bufora
zmniejsza jego wolny obszar co mo¿e doprowadziæ do jego
przepe³nienia. Do pewnego stopnia powiêkszanie jego rozmiaru
rozwi¹zuje problem ale tylko gdy przepe³nianie nastêpuje ze wzglêdu
na rzadkie odczytywanie danych a nie na powolnoœæ algorytmu
przetwarzaj¹cego lub sprzêtu. Gdy mamy do czynienia z tym pierwszym
trzeba pomyœleæ o poprawieniu algorytm&oacute;w a je¿eli s¹ poprawne
po prostu rozbudowaæ sprzêt. Bufor do kt&oacute;rego zapisywane s¹
dane jest jednoczeœnie Ÿr&oacute;d³em danych dla programu. W takich
zastosowaniach dobrze spisuje siê bufor okrê¿ny i jest najprostszym
rozwi¹zaniem. Bufor okrê¿ny nie ma koñca (jako tablica danych ma ale
przez odpowiednie operowanie indeksami zachowuje siê jak by go nie
mia³). Podczas zapisu indeks przesuwany jest na nastêpn¹ pozycjê. Po
obejœciu w ko³o ca³ego bufora - dotarciu do koñca tablicy - indeks
ustawiany jest na pocz¹tek bufora zamykaj¹c &ldquo;okr¹¿enie&rdquo;
niszczy poprzednio zapisan¹ dan¹ (gdy nie by³a odczytana). Je¿eli za
zapisem bêdzie pod¹¿a³ odczyt i pobiera³ wszystkie dane zawracaj¹c na
koñcu tablicy otrzymamy bufor okrê¿ny. Je¿eli odczyt zawiedzie np. ze
wzglêdu na zbyt powolne odbieranie danych indeks zapisu dogoni indeks
odczytu i zacznie zamazywaæ dane nie odczytane. Klasa CRS232 w takiej
sytuacji nie przerywa pracy ustawia jedynie zmienn¹ we_pelny=size_m.
Sprawdzenie czy bufor nie zosta³ przepe³niony nale¿y wykonaæ
samodzielnie komunikatem DAJ_WSKAZNIK_WYPELNIENIA je¿eli jest ok
ioctl() zwraca 0 w przeciwnym wypadku size_m. Bufor wejœciowy uznany
jest za przepe³niony gdy po wykonaniu odczytu z rejestru wejœciowego
i zwiêkszeniu indeksu zapisu zr&oacute;wnuje siê on z indeksem
odczytu. Bufor wyjœciowy trudno przepe³niæ poniewa¿ metoda write()
nie zapisze ¿adnej danej gdy nie ma na ni¹ miejsca. Do wykonania jest
za to inna czynnoœæ. Gdy przed wykonaniem metody write() port
opr&oacute;¿ni³ bufor wyjœciowy i w zwi¹zku z nie wys³aniem danej nie
zosta³a zainicjowana kolejna transmisja, przerwanie nie zostanie ju¿
zg³oszone. Nale¿y wznowiæ transmisjê wykonuj¹c wpis do rejestru
wyjœciowego. O opuszczeniu komputera przez ostatni bajt mo¿na
dowiedzieæ siê tu : LSR.5 . Klasa CRS232 wykorzystuje do tego celu
zmienn¹ wy_pelny przewidzian¹ do sta³ej kontroli wype³nienia bufora
(w procentach) w najprostszej wersji przyjmuje wartoœæ wy_rozmiar gdy
coœ jest w buforze lub wartoœæ 0 gdy zakoñczono transmisjê.</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Instrukcja
obs³ugi:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Tworzymy
statyczny obiekt klasy CRS232;</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">CRS232
com;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Otwieramy
port:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">if(ERR_NODEV==com.open(COM2)){</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 cout&lt;&lt;&quot;error CRS232::open()&quot;&lt;&lt;endl;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 return 0; // lub w inny spos&oacute;b obs³ugujemy b³¹d</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">}</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Coœ tam
odczytujemy :</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">com.read((par_t*)bufor,ile);</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>i
ewentualnie zapisujemy</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">com.write((par_t*)bufor,ile);</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Sterowanie
klas¹ odbywa siê zgodnie z wczeœniejszymi z³o¿eniami poprzez metodê
ioctl()</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Komenda </FONT>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">USTAW_PREDKOSC</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Parametry:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PREDKOSC_2400</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PREDKOSC_4800</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PREDKOSC_9600</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PREDKOSC_19200</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PREDKOSC_28800</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PREDKOSC_38400</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PREDKOSC_57600</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PREDKOSC_115200</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Komenda:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">USTAW_PARZYSTOSC</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Parametry:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PARZYSTOSC_BRAK_KONTROLI</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PARZYSTOSC_KONTR_NIE_PRZYSTOSCI</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">PARZYSTOSC_KONTR_PRZYSTOSCI</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Komenda:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">USTAW_BITY_DANYCH</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Parametry:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">BITY_DANYCH_5</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">BITY_DANYCH_6</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">BITY_DANYCH_7</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">BITY_DANYCH_8</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">Komenda</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>USTAW_BITY_STOPU</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Parametry:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">BITY_STOPU_1</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">BITY_STOPU_2</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Komendy </FONT>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">USTAW_WY_BUF</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Pozwala
zmieniæ rozmiar rozmiar bufora wyjœciowego. Nowy rozmiar podawany
jest jako parametr</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">USTAW_WE_BUF</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Pozwala
zmieniæ rozmiar rozmiar bufora wejœciowego. Nowy rozmiar podawany
jest jako parametr</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">CZYSC_BUFORY</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Opr&oacute;¿nia
oba bufory. Brak parametru</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">WYSLIJ_ZNAK</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Pozwala
wysy³aæ pojedyncze znaki bez wstawiania ich do bufora. Znak jest
wpisywany do rejestru wyjœciowego ale ioctl() odczeka a¿ znak kt&oacute;rego
transmisja jest w trakcie opuœci komputer. Transmitowany znak
podajemy jako parametr.</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">DAJ_WSKAZNIK_WYPELNIENIA</CODE>
Dotyczy bufora wejœciowego</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">DAJ_WSKAZNIK_OPROZNIENIA</CODE>
Dotyczy bufora wyjœciowego</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Komendy
przewidziane do zwracania wype³nienia odpowiednich bufor&oacute;w w
procentach w najprostszym trybie (obecnym) zwracaj¹ 0 gdy bufory s¹
puste. Przepe³nienie bufora wejœciowego sygnalizowane jest wartoœci¹
size_m. Bufor wyjœciowy zwraca sw&oacute;j rozmiar gdy coœ w nim
jest. Inaczej, dla tej wersji klasy, gdy bufory s¹ puste zwracaj¹ 0 a
gdy coœ w nich jest zwracaj¹ wartoœæ r&oacute;¿n¹ od 0. </FONT>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Domyœlne
ustawienia klasy CRS232:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">ioctl(USTAW_PREDKOSC,PREDKOSC_9600);</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">ioctl(USTAW_BITY_DANYCH,BITY_DANYCH_8);</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">ioctl(USTAW_PARZYSTOSC,PARZYSTOSC_BRAK_KONTROLI);</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">ioctl(USTAW_BITY_STOPU,BITY_STOPU_1);</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Na koniec
pracy zamykamy bufor </FONT>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">com.close();</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Przyk³ady:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Przedstawiê
jedynie przyk³ady dla dos. Wszystkie operacje na obiekcie w win s¹
identyczne. Jeden program demonstruje wysy³anie danych a drugi
odbieranie. Po uruchomieniu programu nale¿y wybraæ numer portu kt&oacute;ry
ma byæ wykorzystany w programie. Poniewa¿ klasa CRS232 nie ma
mo¿liwoœci samodzielnego zg³aszania koniecznoœci obs³u¿enia odczyt
nale¿y przeprowadzaæ samodzielnie. Te dwa programy demonstruj¹
przesy³anie napis&oacute;w zakoñczonych znakiem koñca wiersza.
Wstawianie tego znaku ma znaczenie zw³aszcza w przypadku odczytu bo
program tak d³ugo bêdzie zbiera³ dane przed wyœwietleniem dop&oacute;ki
nie odczyta znaku '\n'. Kod zosta³ przetestowany na dw&oacute;ch
komputerach PC. Mo¿na te¿ jako Ÿr&oacute;d³o danych wykorzystaæ jakiœ
sterownik wyposa¿ony w RS232 i wysy³aæ z niego dane do PC na kt&oacute;rym
pracuje program nr 2. Dane wysy³ane do tego programu powinne byæ
tekstowe a ka¿da paczka zakoñczona znakiem '\n'. Wyjaœnienia wymagaj¹
œcie¿ki dostêpu do plik&oacute;w bibliotecznych. Zak³adam istnienie
katalogu przeznaczonego na projekty. W tym katalogu jest katalog
<SPAN LANG="pl-PL">include</SPAN> zawieraj¹cy pliki takie jak ster.*
typy.* rs232.* . W katalogu zawieraj¹cym projekty dla ka¿dego nowego
programu tworzymy nowy katalog np. dla tego artyku³u programy
umieszczone s¹ w katalogu PortRS. Struktura katalog&oacute;w mo¿e
wygl¹daæ tak:</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">c:\projekty\include</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">c:\projekty\PortRS</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">c:\projekty\avt1085</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Program
rs1.cpp</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">#include
&lt;iostream.h&gt;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">#include
&lt;cstring.h&gt;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">#include
&quot;..\include\rs232.h&quot;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">#include
&quot;..\include\typy.h&quot;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">CRS232
com;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">main()</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">{</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western"> 
size_t p;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western"> 
cout&lt;&lt;&quot;numer portu (1,2,3,4) : ?&quot;&lt;&lt;endl;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western"> 
cin&gt;&gt;p;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western"> 
switch(p){</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
case 1:      p=COM1;    break;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
case 2:      p=COM2;    break;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
case 3:      p=COM3;    break;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
case 4:      p=COM4;    break;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
default :</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
  cout&lt;&lt;&quot; z³y numer portu&quot;&lt;&lt;endl;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
  return 0;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">  }</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western"> 
if(ERR_NODEV==com.open(p)){</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
cout&lt;&lt;&quot;error CRS232::open()&quot;&lt;&lt;endl;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
return 0;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">  }</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western"> 
unsigned char buf[100];</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western"> 
string str;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western"> 
while(str!=&quot;exit\n&quot;){</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
cin&gt;&gt;str;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
str+='\n';</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
if(str==&quot;czysc\n&quot;){</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
  com.ioctl(CZYSC_BUFORY);</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
}else{</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
  memcpy(buf,str.c_str(),str.length());</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
  com.write((par_t*)buf,str.length());</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
}</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western"> 
};</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western"> 
if(com.close()!=OK)</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">   
cout&lt;&lt;&quot;blad podczas zamkniecia portu&quot;&lt;&lt;endl;</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><CODE CLASS="western">}</CODE></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2>Program
rs2.cpp</FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">#include
&lt;iostream.h&gt;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">#include
&lt;cstring.h&gt;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">#include
&lt;conio.h&gt;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">#include
&quot;..\include\rs232.h&quot;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">#include
&quot;..\include\typy.h&quot;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">typedef
char teraz;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">CRS232
com;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">main()</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">{</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 size_t p;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 cout&lt;&lt;&quot;numer portu (1,2,3,4) : ?&quot;&lt;&lt;endl;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 cin&gt;&gt;p;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 switch(p){</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
   case 1:      p=COM1;    break;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
   case 2:      p=COM2;    break;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
   case 3:      p=COM3;    break;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
   case 4:      p=COM4;    break;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
   default :</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
     cout&lt;&lt;&quot; z³y numer portu&quot;&lt;&lt;endl;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
     return 0;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 }</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 if(ERR_NODEV==com.open(p)){</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
   cout&lt;&lt;&quot;error CRS232::open()&quot;&lt;&lt;endl;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
   return 0;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 }</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 size_t sz=1000;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 size_t res=0;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 teraz buf[1000];</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 size_t buf_ix=0;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 memset(buf,'\0',sz);</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 char str[1000];</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 size_t str_ix=0;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western"><FONT SIZE=2>
 size_t wskwy;</FONT></CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 memset(str,'\0',sz);</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 do{</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
   res=com.read((par_t*)buf,sz);</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
   if(res)</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
     cout&lt;&lt;&quot;buf po com.read(...) = &quot;&lt;&lt;buf&lt;&lt;endl;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
   while(res--){</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
     com.ioctl(DAJ_WSKAZNIK_WYPELNIENIA,(par_t)&amp;wskwy);</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
     cout&lt;&lt;&quot;wskaznik wypelnienia : &quot;&lt;&lt;wskwy&lt;&lt;endl;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><BR>
</P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
     if((str[str_ix++]=buf[buf_ix++])=='\n'){</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
       cout&lt;&lt;&quot;skompletowano napis : str = &quot;&lt;&lt;str;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
       memset(str,'\0',str_ix);</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
       str_ix=0;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
       cout&lt;&lt;&quot;pobiera kolejny ciag&quot;&lt;&lt;endl;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
     }</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
   }</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
   memset(buf,'\0',buf_ix);</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
   buf_ix=0;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 }while(!kbhit());</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
 if(com.close()!=OK)</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">
   cout&lt;&lt;&quot;blad podczas zamkniecia portu&quot;&lt;&lt;endl;</CODE></FONT></P>
<P ALIGN=JUSTIFY STYLE="margin-bottom: 0cm"><FONT SIZE=2><CODE CLASS="western">}</CODE></FONT></P>
</BODY>
</HTML>